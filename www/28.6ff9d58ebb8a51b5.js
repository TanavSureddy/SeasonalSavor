"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[28],{28:(I,u,i)=>{i.r(u),i.d(u,{OtpPageModule:()=>M});var d=i(1368),o=i(4716),l=i(2112),p=i(7632),m=i(1528),h=i(4276),t=i(4496),v=i(7084),b=i(5288);function y(e,f){if(1&e&&(t.I0R(0,"div",9),t.OEk(1),t.C$Y()),2&e){const a=t.GaO().index;t.yG2(),t.oRS(" Invalid OTP entered at position ",a+1,". Only one digit at one placeholder ")}}function O(e,f){if(1&e&&(t.I0R(0,"div"),t.wR5(1,"ion-input",7),t.yuY(2,y,2,1,"div",8),t.C$Y()),2&e){const a=f.$implicit;t.yG2(),t.E7m("formControl",a),t.yG2(),t.E7m("ngIf",a.invalid&&a.touched)}}const C=[{path:"",component:(()=>{class e{constructor(a,r,s,g,c){this.router=a,this.fb=r,this.dataSharingService=s,this.globals=g,this.toastController=c}ngOnInit(){this.initializeForm()}initializeForm(){this.otpForm=this.fb.group({otp1:["",[o.AQ.required,o.AQ.pattern(/^\d{1}$/)]],otp2:["",[o.AQ.required,o.AQ.pattern(/^\d{1}$/)]],otp3:["",[o.AQ.required,o.AQ.pattern(/^\d{1}$/)]],otp4:["",[o.AQ.required,o.AQ.pattern(/^\d{1}$/)]]}),this.otpControls=Object.keys(this.otpForm.controls).map(a=>this.otpForm.controls[a])}successToast(){this.toastController.create({message:"Successfully registered. Please login to continue.",duration:3e3,position:"top",color:"success"}).then(a=>{a.present()})}errorToast(a){this.toastController.create({message:a,duration:3e3,position:"top",color:"danger"}).then(r=>{r.present()})}redirectToHome(){var a=this;return(0,m.c)(function*(){a.dataSharingService.setFormData(a.otpForm.value);const s=a.dataSharingService.getFormData(),g=a.dataSharingService.loginMode?"https://api.jykrasolutions.com/api/user/login":"https://api.jykrasolutions.com/api/user/register";yield h.c.post(g,s).then(function(){var c=(0,m.c)(function*(n){"Invalid OTP for login"===n.data.message||"User not registered"===n.data.message?a.errorToast("Invalid OTP. Please try again."):a.dataSharingService.loginMode?(a.globals.authenticated=!0,a.dataSharingService.clearFormData(),a.globals.user.name=yield n.data.name,a.globals.user.mobileNumber=yield n.data.mobileNumber,a.globals.saveLocalData("loggedIn","true"),a.globals.saveLocalData("name",n.data.name),a.globals.saveLocalData("mobileNumber",n.data.mobileNumber),a.globals.saveLocalData("userType",n.data.userType),a.globals.saveLocalData("userId",n.data.userId),a.globals.saveLocalData("city",n.data.city),a.globals.saveLocalData("area",n.data.area),a.globals.saveLocalData("building",n.data.building),a.globals.saveLocalData("flatNumber",n.data.flatNumber),a.globals.saveLocalData("floor",n.data.floor),a.router.navigate(["/tabs/home"])):("User already exists"===n.data.message?a.errorToast("User already exists. Please login to continue."):a.successToast(),a.dataSharingService.loginMode=!0,a.router.navigate(["/login"]))});return function(n){return c.apply(this,arguments)}}()).catch(c=>{console.error("Error posting user information to the backend:",c),a.errorToast("Server is unreachable. Please try again later")})})()}static#t=this.\u0275fac=function(r){return new(r||e)(t.GI1(p.E5),t.GI1(o.im),t.GI1(v.A),t.GI1(b.G),t.GI1(l.Gq))};static#a=this.\u0275cmp=t.In1({type:e,selectors:[["app-otp"]],decls:13,vars:5,consts:[[3,"fullscreen"],[1,"pageWrapper","ion-padding"],[1,"pageRow","ion-margin-vertical"],[3,"formGroup"],[1,"otpWrapper","ion-margin-bottom","ion-padding-bottom"],[4,"ngFor","ngForOf"],["expand","block",3,"disabled","click"],["type","number",1,"loginInput",3,"formControl"],["class","invalid-message",4,"ngIf"],[1,"invalid-message"]],template:function(r,s){1&r&&(t.I0R(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"p"),t.OEk(4,"We have sent a verification code to"),t.wR5(5,"br"),t.I0R(6,"b"),t.OEk(7),t.C$Y()(),t.I0R(8,"form",3)(9,"div",4),t.yuY(10,O,3,2,"div",5),t.C$Y(),t.I0R(11,"ion-button",6),t.qCj("click",function(){return s.redirectToHome()}),t.OEk(12,"Continue"),t.C$Y()()()()()),2&r&&(t.E7m("fullscreen",!0),t.yG2(7),t.cNF(s.dataSharingService.getFormData().mobileNumber),t.yG2(),t.E7m("formGroup",s.otpForm),t.yG2(2),t.E7m("ngForOf",s.otpControls),t.yG2(),t.E7m("disabled",s.otpForm.invalid))},dependencies:[d.ay,d.u_,o.sz,o.ue,o.u,o.ug,o.uW,l.sn,l._i,l.A5,l.Ch],styles:["ion-title.title-large[_ngcontent-%COMP%]{color:#fff;font-size:30px}ion-title[_ngcontent-%COMP%]{--color: #000}ion-toolbar[_ngcontent-%COMP%]{--background: #ffffff}.pageWrapper[_ngcontent-%COMP%]   .pageRow[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#000000de;text-align:center;font-size:18px;font-style:normal;font-weight:500;line-height:normal;margin:30px 0;padding:0;line-height:25px}.pageWrapper[_ngcontent-%COMP%]   .pageRow[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{font-weight:700}.pageWrapper[_ngcontent-%COMP%]   .pageRow[_ngcontent-%COMP%]   .otpWrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row;column-gap:20px;justify-content:center}.pageWrapper[_ngcontent-%COMP%]   .pageRow[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{width:100%;height:50px;text-align:center;border-color:var(--border-color);border-width:1px;border-style:solid;--border-radius: 10px;border-radius:10px}"]})}return e})()}];let P=(()=>{class e{static#t=this.\u0275fac=function(r){return new(r||e)};static#a=this.\u0275mod=t.a4G({type:e});static#e=this.\u0275inj=t.s3X({imports:[p.qQ.forChild(C),p.qQ]})}return e})(),M=(()=>{class e{static#t=this.\u0275fac=function(r){return new(r||e)};static#a=this.\u0275mod=t.a4G({type:e});static#e=this.\u0275inj=t.s3X({imports:[d.MD,o.y,o.sl,l.wZ,P]})}return e})()}}]);